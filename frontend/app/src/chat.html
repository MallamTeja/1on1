<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - SkillSync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-black text-white min-h-screen flex">
    <!-- Sidebar -->
    <div class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-code text-white text-sm"></i>
                </div>
                <span class="text-xl font-bold text-purple-400">SkillSync</span>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4">
            <ul class="space-y-2">
                <li>
                    <a href="dashboard.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors" data-page="dashboard">
                        <i class="fas fa-th-large w-5"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="profile.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors" data-page="profile">
                        <i class="fas fa-user w-5"></i>
                        <span>Profile</span>
                    </a>
                </li>
                <li>
                    <a href="chat.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg bg-purple-600/20 text-purple-400 border border-purple-500/30" data-page="chat">
                        <i class="fas fa-comments w-5"></i>
                        <span>Chat</span>
                    </a>
                </li>
                <li>
                    <a href="assignments.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors" data-page="assignments">
                        <i class="fas fa-tasks w-5"></i>
                        <span>Assignments</span>
                    </a>
                </li>
                <li>
                    <a href="mentorship.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors" data-page="mentorship">
                        <i class="fas fa-user-graduate w-5"></i>
                        <span>Mentorship</span>
                    </a>
                </li>
                <li>
                    <a href="educonnect.html" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors" data-page="educonnect">
                        <i class="fas fa-users w-5"></i>
                        <span>EduConnect</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Bottom Actions -->
        <div class="p-4 border-t border-gray-800 space-y-2">
            <a href="profile.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors">
                <i class="fas fa-cog w-5"></i>
                <span>Settings</span>
            </a>
            <button onclick="handleLogout()" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-red-400 hover:text-red-300 hover:bg-red-900/20 transition-colors w-full text-left">
                <i class="fas fa-sign-out-alt w-5"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex">
        <!-- Chat Area -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <header class="bg-gray-900/50 border-b border-gray-800 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold">AJ</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Alex Johnson</h1>
                            <p class="text-sm text-green-400">Online</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="Search for mentors, challenges..." 
                                   class="w-80 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button class="p-2 text-purple-400 hover:text-purple-300 transition-colors">
                            <i class="fas fa-video text-xl"></i>
                        </button>
                        <button class="p-2 text-purple-400 hover:text-purple-300 transition-colors">
                            <i class="fas fa-phone text-xl"></i>
                        </button>
                        <button class="p-2 text-purple-400 hover:text-purple-300 transition-colors">
                            <i class="fas fa-ellipsis-v text-xl"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Chat Messages -->
            <div class="flex-1 p-6 bg-gradient-to-br from-purple-900/20 to-blue-900/20 overflow-y-auto" id="chatMessages">
                <!-- Message from Alex -->
                <div class="flex items-start space-x-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold text-sm">AJ</span>
                    </div>
                    <div class="flex-1">
                        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl rounded-tl-sm p-4 max-w-md">
                            <p class="text-white">Hey Alex! How's the new coding challenge going? I heard it's quite tricky.</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 ml-2">10:00 AM</p>
                    </div>
                </div>

                <!-- Message from User -->
                <div class="flex items-start space-x-3 mb-6 justify-end">
                    <div class="flex-1 flex justify-end">
                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl rounded-tr-sm p-4 max-w-md">
                            <p class="text-white">It's a tough one, for sure! I'm stuck on the algorithm optimization part. Need to figure out the time complexity.</p>
                        </div>
                    </div>
                    <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                </div>
                <div class="flex justify-end mb-6">
                    <p class="text-xs text-gray-500 mr-14">10:02 AM</p>
                </div>

                <!-- Message from Alex -->
                <div class="flex items-start space-x-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold text-sm">AJ</span>
                    </div>
                    <div class="flex-1">
                        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl rounded-tl-sm p-4 max-w-md">
                            <p class="text-white">Ah, the classic! Have you tried reviewing dynamic programming techniques? Sometimes a fresh perspective helps unlock those optimizations.</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 ml-2">10:05 AM</p>
                    </div>
                </div>

                <!-- Message from User -->
                <div class="flex items-start space-x-3 mb-6 justify-end">
                    <div class="flex-1 flex justify-end">
                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl rounded-tr-sm p-4 max-w-md">
                            <p class="text-white">Yeah, I've been looking into it. The data structures are what's really throwing me off. Thinking about setting up a call to whiteboard it.</p>
                        </div>
                    </div>
                    <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                </div>
                <div class="flex justify-end mb-6">
                    <p class="text-xs text-gray-500 mr-14">10:07 AM</p>
                </div>

                <!-- Message from Alex -->
                <div class="flex items-start space-x-3 mb-6">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold text-sm">AJ</span>
                    </div>
                    <div class="flex-1">
                        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl rounded-tl-sm p-4 max-w-md">
                            <p class="text-white">Good idea! Let me know if you want another pair of eyes on it. I'm free later this afternoon.</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 ml-2">10:09 AM</p>
                    </div>
                </div>

                <!-- Message from User -->
                <div class="flex items-start space-x-3 mb-6 justify-end">
                    <div class="flex-1 flex justify-end">
                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl rounded-tr-sm p-4 max-w-md">
                            <p class="text-white">Awesome, thanks! I'll ping you in a bit to set it up. Appreciate the help!</p>
                        </div>
                    </div>
                    <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                </div>
                <div class="flex justify-end mb-6">
                    <p class="text-xs text-gray-500 mr-14">10:30 AM</p>
                </div>

                <!-- Typing indicator -->
                <div class="flex items-start space-x-3 mb-6" id="typingIndicator" style="display: none;">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold text-sm">AJ</span>
                    </div>
                    <div class="flex-1">
                        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl rounded-tl-sm p-4 max-w-md">
                            <p class="text-gray-400 text-sm">Alex Johnson is typing...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Input -->
            <div class="p-6 border-t border-gray-800 bg-gray-900/50">
                <div class="flex items-center space-x-4">
                    <button class="p-3 text-gray-400 hover:text-purple-400 transition-colors">
                        <i class="fas fa-paperclip text-xl"></i>
                    </button>
                    <button class="p-3 text-gray-400 hover:text-purple-400 transition-colors">
                        <i class="fas fa-smile text-xl"></i>
                    </button>
                    <div class="flex-1 relative">
                        <input type="text" 
                               placeholder="Type your message..." 
                               id="messageInput"
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 pr-12">
                    </div>
                    <button onclick="sendMessage()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white p-3 rounded-lg transition-all transform hover:scale-105">
                        <i class="fas fa-paper-plane text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
 <!-- Connectdfions Sideba\fdr -->
        <!-- Connections Sidebar -->
        <div class="w-80 bg-gray-900/50 border-l border-gray-800 flex flex-col">
            <div class="p-6 border-b border-gray-800">
                <h2 class="text-xl font-bold text-white">Connections</h2>
            </div>
            
            <div class="flex-1 p-4 overflow-y-auto">
                <!-- Online Users -->
                <div class="space-y-3">
                    <!-- Alex Johnson -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg bg-gray-800/50 hover:bg-gray-800 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">AJ</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">Alex Johnson</h3>
                            <p class="text-sm text-green-400">Awesome, thanks! I'll ping you in a bit...</p>
                        </div>
                    </div>

                    <!-- Sarah Chen -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">SC</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">Sarah Chen</h3>
                            <p class="text-sm text-gray-400">I've started on the assignment...</p>
                        </div>
                    </div>

                    <!-- David Lee -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">DL</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">David Lee</h3>
                            <p class="text-sm text-gray-400">See you next week!</p>
                        </div>
                    </div>

                    <!-- Emily White -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">EW</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">Emily White</h3>
                            <p class="text-sm text-gray-400">Planning the next sprint...</p>
                        </div>
                    </div>

                    <!-- Michael Brown -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">MB</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-gray-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">Michael Brown</h3>
                            <p class="text-sm text-gray-400">Don't forget the daily standup.</p>
                        </div>
                    </div>

                    <!-- Jessica Green -->
                    <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-r from-teal-500 to-green-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold">JG</span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900"></div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-white font-medium">Jessica Green</h3>
                            <p class="text-sm text-gray-400">Just finished the PR review.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="nav-script.js"></script>
    <script>
        // Authentication check
        const auth = new AuthManager();
        
        // Check if user is authenticated
        if (!auth.isAuthenticated()) {
            window.location.href = 'pages/login.html';
        }
        
        // Initialize chat application
        document.addEventListener('DOMContentLoaded', async function() {
            const authManager = new AuthManager();
            
            // Check authentication
            if (!authManager.requireAuth()) {
                return;
            }
            
            // Load user data and initialize chat
            const user = authManager.getCurrentUser();
            if (user) {
                initializeChat(user);
                loadConnections();
            }
        });
        
        // Initialize chat with user data
        function initializeChat(user) {
            // Update user avatar in header if needed
            const userElements = document.querySelectorAll('.bg-gray-600');
            userElements.forEach(element => {
                if (element.querySelector('.fa-user')) {
                    const initials = user.fullName ? user.fullName.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
                    element.innerHTML = `<span class="text-white font-bold text-sm">${initials}</span>`;
                    element.classList.remove('bg-gray-600');
                    element.classList.add('bg-gradient-to-r', 'from-green-500', 'to-emerald-500');
                }
            });
        }
        
        // Load connections from API
        async function loadConnections() {
            try {
                const authManager = new AuthManager();
                const token = authManager.getToken();
                
                const response = await fetch('/api/connections', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.connections) {
                        updateConnectionsList(data.connections);
                    }
                }
            } catch (error) {
                console.error('Error loading connections:', error);
            }
        }
        
        // Update connections list with real data
        function updateConnectionsList(connections) {
            const connectionsContainer = document.querySelector('.space-y-3');
            if (connectionsContainer && connections.length > 0) {
                connectionsContainer.innerHTML = connections.map(connection => {
                    const initials = connection.fullName ? connection.fullName.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
                    const statusColor = connection.isOnline ? 'bg-green-500' : 'bg-gray-500';
                    const gradientClass = getRandomGradient();
                    
                    return `
                        <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800/50 transition-colors cursor-pointer" onclick="openChat('${connection._id}', '${connection.fullName}')">
                            <div class="relative">
                                <div class="w-12 h-12 ${gradientClass} rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold">${initials}</span>
                                </div>
                                <div class="absolute -bottom-1 -right-1 w-4 h-4 ${statusColor} rounded-full border-2 border-gray-900"></div>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-white font-medium">${connection.fullName}</h3>
                                <p class="text-sm text-gray-400">${connection.lastMessage || 'No messages yet'}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        // Get random gradient for avatars
        function getRandomGradient() {
            const gradients = [
                'bg-gradient-to-r from-purple-500 to-blue-500',
                'bg-gradient-to-r from-blue-500 to-cyan-500',
                'bg-gradient-to-r from-green-500 to-emerald-500',
                'bg-gradient-to-r from-pink-500 to-purple-500',
                'bg-gradient-to-r from-orange-500 to-red-500',
                'bg-gradient-to-r from-teal-500 to-green-500'
            ];
            return gradients[Math.floor(Math.random() * gradients.length)];
        }
        
        // Open chat with specific user
        function openChat(userId, userName) {
            // Update header with selected user
            const headerName = document.querySelector('header h1');
            const headerAvatar = document.querySelector('header .bg-gradient-to-r span');
            
            if (headerName) headerName.textContent = userName;
            if (headerAvatar) {
                const initials = userName.split(' ').map(n => n[0]).join('').toUpperCase();
                headerAvatar.textContent = initials;
            }
            
            // Load chat history for this user
            loadChatHistory(userId);
        }
        
        // Load chat history
        async function loadChatHistory(userId) {
            try {
                const authManager = new AuthManager();
                const token = authManager.getToken();
                
                const response = await fetch(`/api/chat/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.messages) {
                        displayChatHistory(data.messages);
                    }
                }
            } catch (error) {
                console.error('Error loading chat history:', error);
            }
        }
        
        // Display chat history
        function displayChatHistory(messages) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            messages.forEach(message => {
                addMessageToChat(message.content, message.isFromCurrentUser, message.timestamp, message.senderName);
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }


        // Send message function
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (message) {
                // Add message to UI immediately
                addMessage(message, true);
                messageInput.value = '';
                
                // Send message to server
                try {
                    const authManager = new AuthManager();
                    const token = authManager.getToken();
                    const currentChatUserId = getCurrentChatUserId(); // You'll need to implement this
                    
                    const response = await fetch('/api/chat/send', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            recipientId: currentChatUserId,
                            message: message
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to send message');
                    }
                    
                } catch (error) {
                    console.error('Error sending message:', error);
                    showToast('Failed to send message', 'error');
                }
                
                // Simulate typing indicator for demo
                showTypingIndicator();
                
                // Simulate response after 2 seconds
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage("Thanks for the message! I'll get back to you soon.", false);
                }, 2000);
            }
        }
        
        // Get current chat user ID (implement based on your chat state management)
        function getCurrentChatUserId() {
            // This should return the ID of the user currently being chatted with
            // For now, return a default value
            return 'default-user-id';
        }

        // Add message to chat
        function addMessage(text, isUser, timestamp = null, senderName = null) {
            addMessageToChat(text, isUser, timestamp, senderName);
        }
        
        // Add message to chat (enhanced version)
        function addMessageToChat(text, isUser, timestamp = null, senderName = null) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const currentTime = timestamp ? new Date(timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            if (isUser) {
                const authManager = new AuthManager();
                const user = authManager.getCurrentUser();
                const userInitials = user && user.fullName ? user.fullName.split(' ').map(n => n[0]).join('').toUpperCase() : 'U';
                
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3 mb-6 justify-end">
                        <div class="flex-1 flex justify-end">
                            <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl rounded-tr-sm p-4 max-w-md">
                                <p class="text-white">${text}</p>
                            </div>
                        </div>
                        <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white font-bold text-sm">${userInitials}</span>
                        </div>
                    </div>
                    <div class="flex justify-end mb-6">
                        <p class="text-xs text-gray-500 mr-14">${currentTime}</p>
                    </div>
                `;
            } else {
                const otherUserInitials = senderName ? senderName.split(' ').map(n => n[0]).join('').toUpperCase() : 'AJ';
                
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3 mb-6">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white font-bold text-sm">${otherUserInitials}</span>
                        </div>
                        <div class="flex-1">
                            <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-2xl rounded-tl-sm p-4 max-w-md">
                                <p class="text-white">${text}</p>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 ml-2">${currentTime}</p>
                        </div>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium transform translate-x-full transition-all duration-300 z-50`;
            
            const bgColors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            toast.classList.add(bgColors[type] || bgColors.info);
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 4000);
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'flex';
            
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'none';
        }

        // Handle Enter key in message input
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Add hover effects to navigation items
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('mouseenter', function() {
                if (!this.classList.contains('bg-purple-600/20')) {
                    this.classList.add('transform', 'scale-105');
                }
            });
            
            link.addEventListener('mouseleave', function() {
                this.classList.remove('transform', 'scale-105');
            });
        });

        // Add hover effects to connection items
        document.querySelectorAll('.cursor-pointer').forEach(item => {
            item.addEventListener('mouseenter', function() {
                this.classList.add('transform', 'scale-105');
            });
            
            item.addEventListener('mouseleave', function() {
                this.classList.remove('transform', 'scale-105');
            });
        });

        // Auto-scroll chat to bottom on load
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    </script>
</body>
</html>
